<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v8.4.0 <https://hydejack.com/>
--><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>OverTheWire natas 5-9 | Fjanks security pages</title><meta name="generator" content="Jekyll v3.8.5" /><meta property="og:title" content="OverTheWire natas 5-9" /><meta name="author" content="Fjank" /><meta property="og:locale" content="en" /><meta name="description" content="A walkthrough of OverTheWire natas 5-9 with tool recommendations, recommendations for further reading, recommendations for protecting your server against attackers, failures and wins. Natas level 5-9 is quite easy, giving you a very gentle introduction to this wargame." /><meta property="og:description" content="A walkthrough of OverTheWire natas 5-9 with tool recommendations, recommendations for further reading, recommendations for protecting your server against attackers, failures and wins. Natas level 5-9 is quite easy, giving you a very gentle introduction to this wargame." /><link rel="canonical" href="https://fjank.no/blog/2019-03-17-overthewire-natas-5-9/" /><meta property="og:url" content="https://fjank.no/blog/2019-03-17-overthewire-natas-5-9/" /><meta property="og:site_name" content="Fjanks security pages" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-03-17T00:00:00+01:00" /> <script type="application/ld+json"> {"@type":"BlogPosting","headline":"OverTheWire natas 5-9","dateModified":"2019-03-17T00:00:00+01:00","datePublished":"2019-03-17T00:00:00+01:00","url":"https://fjank.no/blog/2019-03-17-overthewire-natas-5-9/","mainEntityOfPage":{"@type":"WebPage","@id":"https://fjank.no/blog/2019-03-17-overthewire-natas-5-9/"},"author":{"@type":"Person","name":"Fjank"},"description":"A walkthrough of OverTheWire natas 5-9 with tool recommendations, recommendations for further reading, recommendations for protecting your server against attackers, failures and wins. Natas level 5-9 is quite easy, giving you a very gentle introduction to this wargame.","@context":"http://schema.org"}</script><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Fjanks security pages"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="application-name" content="Fjanks security pages"><meta name="msapplication-config" content="/assets/ieconfig.xml"><meta name="theme-color" content="rgb(25,55,71)"><meta name="generator" content="Hydejack v8.4.0" /><link type="application/atom+xml" rel="alternate" href="https://fjank.no/feed.xml" title="Fjanks security pages" /><link rel="alternate" href="https://fjank.no/blog/2019-03-17-overthewire-natas-5-9/" hreflang="en"><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon.png"><link rel="manifest" href="/assets/manifest.json"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="dns-prefetch" href="/" id="_baseURL"><link rel="dns-prefetch" href="/assets/js/hydejack-8.4.0.js" id="_hrefJS"><link rel="dns-prefetch" href="/sw.js" id="_hrefSW"><link rel="dns-prefetch" href="/assets/bower_components/fontfaceobserver/fontfaceobserver.standalone.js" id="_hrefFFO"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js" id="_hrefKatexJS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_hrefKatexCSS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/contrib/copy-tex.min.js" id="_hrefKatexCopyJS"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/contrib/copy-tex.min.css" id="_hrefKatexCopyCSS"><link rel="dns-prefetch" href="/assets/img/swipe.svg" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="https://fjank-no.disqus.com" id="_hrefDisqus"> <script>!function(e,t){"use strict";function n(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}e.loadJS=function(e,r){var o=t.createElement("script");o.src=e,r&&n(o,"load",r,{once:!0});var a=t.scripts[0];return a.parentNode.insertBefore(o,a),o},e._loaded=!1,e.loadJSDeferred=function(r,o){function a(){e._loaded=!0,o&&n(d,"load",o,{once:!0});var r=t.scripts[0];r.parentNode.insertBefore(d,r)}var d=t.createElement("script");return d.src=r,e._loaded?a():n(e,"load",a,{once:!0}),d},e.setRel=e.setRelStylesheet=function(e){function n(){this.rel="stylesheet"}var r=t.getElementById(e);r.addEventListener?r.addEventListener("load",n,{once:!0}):r.onload=n}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); </script> <script>!function(w, d) { w._noPushState = false; w._noDrawer = false; /**/ loadJS(d.getElementById('_hrefFFO').href, function() { if ('Promise' in w) Promise.all([ new FontFaceObserver('Noto Sans').load(), new FontFaceObserver('Roboto Slab').load(), ]).then(function f() { d.body.classList.add('font-active'); }, function() {}); }); /**/ }(window, document);</script> <!--[if gt IE 8]><!----><style> body{--code-font-family: Menlo,Monaco,Consolas,monospace;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 400;--text-muted: #888;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,body,hr,.hr,table:not(.highlight) td,table:not(.highlight) th,.message{transition:background-color 1s ease, border-color 1s ease}.no-color-transition{transition:none !important}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-size:16px;line-height:1.75}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}a{text-decoration:none}.lead{margin-left:-1rem;margin-right:-1rem}.content img,.img,.content video,.video{max-width:100%}.content img.lead,.img.lead,.content video.lead,.video.lead{max-width:calc(100% + 2rem);width:calc(100% + 2rem)}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{font-weight:var(--font-weight-heading);margin:5rem 0 1rem}h1,.h1{font-size:2rem;line-height:1.3}h2,.h2{font-size:1.5rem;line-height:1.4}h3,.h3{font-size:1.17em;line-height:1.5}h4,h5,h6,.h4,.h5,.h6{font-size:1rem;margin-bottom:0.5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr{position:relative;margin:3rem 0;border:0;border-top:1px solid var(--border-color)}.hr{border-bottom:1px solid var(--border-color);padding-bottom:1rem;margin-bottom:2rem}table:not(.highlight){border-collapse:collapse;margin-bottom:2rem;margin-left:-1rem}table:not(.highlight) td,table:not(.highlight) th{padding:.25rem .5rem;border:1px solid var(--border-color)}table:not(.highlight) td:first-child,table:not(.highlight) th:first-child{padding-left:1rem}table:not(.highlight) td:last-child,table:not(.highlight) th:last-child{padding-right:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{margin-bottom:2rem}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:var(--text-muted)}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}@media screen{body::before{content:'';width:.5rem;background:var(--border-color);position:fixed;left:0;top:0;bottom:0}}@media screen and (min-width: 64em){body::before{width:21rem}}@media screen and (min-width: 1666px){body::before{width:calc(50% - 28rem)}}@media screen and (min-width: 42em){html{font-size:17px}}@media screen and (min-width: 124em){html{font-size:18px}}.fade-in{animation-duration:500ms;animation-timing-function:ease;animation-name:fade-in;animation-fill-mode:forwards}@keyframes fade-in{from{transform:translateY(-3rem);opacity:0}50%{transform:translateY(-3rem);opacity:0}to{transform:translateY(0);opacity:1}}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.border{border:1px solid var(--border-color)}hy-push-state a,.a{position:relative;padding-bottom:.15rem;border-bottom:1px solid}hy-push-state a.no-hover,.a.no-hover{border-bottom:none;padding-bottom:0}.content .img{overflow:hidden}.content .img img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1666px){hy-drawer{width:calc(50% - 28rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;z-index:2;min-height:100vh}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>h2{margin-top:0}.sidebar-nav>ul{list-style:none;padding-left:0}a.sidebar-nav-item{display:inline-block;font-weight:var(--font-weight-heading);line-height:1.75;padding:.25rem;border-bottom:1px solid rgba(255,255,255,0.2)}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-top,.fixed-bottom{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{padding-top:0;padding-bottom:0;min-height:0;color:var(--menu-text)}.nav-btn-bar{margin:0 -1rem 0 -.875rem}.nav-btn{background:none;border:none;padding:1.75rem .875rem;color:var(--menu-text) !important;cursor:pointer}.animation-main{opacity:0;pointer-events:none}.content{position:relative;margin-left:auto;margin-right:auto;padding:6rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;max-width:38rem;min-height:100vh}}@media screen and (min-width: 54em){.content{max-width:42rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 90em){.content{margin-left:25rem;margin-right:4rem;max-width:48rem}}@media screen and (min-width: 1666px){.content{margin:auto}}.avatar{width:6.5rem;height:6.5rem;border-radius:100%;overflow:hidden}@media screen and (min-width: 90em){.avatar{width:7rem;height:7rem}}.content .avatar{float:right;margin-left:.5rem}html{font-family:Helvetica, Arial, sans-serif}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-family:Helvetica, Arial, sans-serif}.font-active{font-family:Noto Sans,Helvetica,Arial,sans-serif}.font-active h1,.font-active h2,.font-active h3,.font-active h4,.font-active h5,.font-active h6,.font-active .h1,.font-active .h2,.font-active .h3,.font-active .h4,.font-active .h5,.font-active .h6,.font-active .heading{font-family:Roboto Slab,Helvetica,Arial,sans-serif}.content a:not(.btn){color:#4fb1ba;border-color:rgba(79,177,186,0.2)}.content a:not(.btn):hover{border-color:#4fb1ba}:focus{outline-color:#4fb1ba !important}.btn-primary{color:#fff;background-color:#4fb1ba;border-color:#4fb1ba}.btn-primary:focus,.btn-primary.focus,.form-control:focus,.form-control.focus{box-shadow:0 0 0 3px rgba(79,177,186,0.5)}.btn-primary:hover,.btn-primary.hover{color:#fff;background-color:#409ba3;border-color:#409ba3}.btn-primary:disabled,.btn-primary.disabled{color:#fff;background-color:#4fb1ba;border-color:#4fb1ba}.btn-primary:active,.btn-primary.active{color:#fff;background-color:#409ba3;border-color:#409ba3}::selection{color:#fff;background:#4fb1ba}::-moz-selection{color:#fff;background:#4fb1ba}</style><link rel="preload" as="style" href="/assets/css/hydejack-8.4.0.css" id="_stylePreload"> <script>setRel('_stylePreload');</script><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"> <script>setRel('_iconsPreload');</script><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400|Noto+Sans:400,400i,700,700i" id="_fontsPreload"> <script>setRel('_fontsPreload');</script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-8.4.0.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400|Noto+Sans:400,400i,700,700i"><style> html { font-family: Noto Sans, Helvetica, Arial, sans-serif!important; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Roboto Slab, Helvetica, Arial, sans-serif!important; }</style></noscript> <!--<![endif]--><link rel="dns-prefetch" href="https://webmention.io"><link rel="preconnect" href="https://webmention.io"><link rel="preconnect" href="ws://webmention.io:8080"><link rel="pingback" href="https://webmention.io/fjank.no/xmlrpc"><link rel="webmention" href="https://webmention.io/fjank.no/webmention"><body><div id="_navbar" class="navbar fixed-top"><div class="content"><div class="nav-btn-bar"> <span class="sr-only">Jump to:</span> <a id="_menu" class="nav-btn no-hover fl" href="#_navigation"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a></div></div></div><hr class="sr-only" hidden /> <hy-push-state replace-ids="_main" link-selector="a[href]:not([href*='/assets/']):not(.external):not(.no-push-state)" duration="250" script-selector="script:not([type^='math/tex'])" prefetch ><main id="_main" class="content fade-in layout-post" role="main" data-color="rgb(79,177,186)" data-theme-color="rgb(25,55,71)" data-image="/assets/img/sidebar-bg.jpg" data-overlay ><article id="post-blog-overthewire-natas-5-9" class="page post mb6 h-entry" role="article"><header><h1 class="post-title p-name"> OverTheWire natas 5-9</h1><p class="post-date heading"> <time class="dt-published" datetime="2019-03-17T00:00:00+01:00">17 Mar 2019</time> in <a href="/blog/" class="flip-title">Blog</a><p class="message" > A walkthrough of OverTheWire natas 5-9 with tool recommendations, recommendations for further reading, recommendations for protecting your server against attackers, failures and wins. Natas level 5-9 is quite easy, giving you a very gentle introduction to this wargame.</header><div class="e-content"><p><a href="/blog/2019-03-14-overthewire-natas-0-4/">Read Previous - OverTheWire level 0-4 walkthrough.</a><h2 id="introduction">Introduction</h2><p><a href="http://overthewire.org">OverTheWire</a> is a wargame site with several challenges. For a beginner like me, it contains several challenges with a nice increase in difficulty. This is the second entry of a writeup of the <a href="http://overthewire.org/wargames/natas/">natas</a> challenges, which teaches the basics of serverside web-security. I will not expose the actual passwords, but rather walk you through the mind-process of searching for and finding vulnerabilities.<p>By going through all the levels of these challenges, you will learn how to break basic security (and protect against these attacks!), gain basic knowledge on various tools such as: html, server configuration, browser developer tools, basic shell commands, vulnerability checker tools, kali linux and get some basic programming experience.<h2 id="level-5">Level 5</h2><p class="message"><strong>Tools recommended:</strong> <a href="https://portswigger.net/">Burp Suite</a>.<p>Here we are met with a page stating that we are not logged in, and no interaction features.   <hy-img root-margin="512px"  src="/assets/img/overthewire-natas5-1.png" alt="Natas 5 landing page" >    <noscript><img data-ignore  src="/assets/img/overthewire-natas5-1.png" alt="Natas 5 landing page" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> The source code looks equally empty. In some way the site has figured out that we are not logged in, so lets look at the site <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">cookies</a> (using the browser developer tools), as cookies is a good way to store session handles.<p>There should be a cookie there with the name “loggedin” with value 0 (This is NOT the correct way to store session information!). This time we are going to use <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">Burp Suite’s Repeater</a> to manipulate the request before sending to natas5. Repeater is a fantastic exploratory tool to test various techniques and theories.<p>Make sure you have installed and set up Burp suite and configured your browser. Just follow PageSwigger getting started instructions on their site. When visiting natas5, Burp Suite should intercept this request in the “Proxy” tab. there you should click the “Action” button, and select “Send to Repeater”. Now you are finished in the “Proxy” tab, so you could turn off intercept by clicking the “Intercept is on” button.<p>If you now switch to the “Repeater” tab, you will see the complete raw request that is sent to natas5. You may press the “Go” button to see the response, do also explore the params and headers tabs to see what info is there. I have removed most of the headers sent, leaving only the necessary headers.   <hy-img root-margin="512px"  src="/assets/img/overthewire-natas5-2.png" alt="Burp suite Repeater for natas5" >    <noscript><img data-ignore  src="/assets/img/overthewire-natas5-2.png" alt="Burp suite Repeater for natas5" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> In the params tab change the isloggedin cookie value from 0 to 1, then press the “Go” button. If you now inspect the result, you will see the the server is now happy, and gives you the password for the next level.<p>Also take a look at the raw tab, to see what you actually sent to the server. You could also change the values directly in the raw tab.<p><em>Lessons learned: Don’t store data at all in the cookies, they are easily spoofed.</em><h2 id="level-6">Level 6</h2><p>This time we are met with a page with an input field “Input secret”, and a submit button, and it also seems we have a link to the server side source code for help. A few tests with the input field, gives us “Wrong secret”. So obviously we need to find the correct secret to solve this one.   <hy-img root-margin="512px"  src="/assets/img/overthewire-natas6-1.png" alt="Natas 6 landing page" >    <noscript><img data-ignore  src="/assets/img/overthewire-natas6-1.png" alt="Natas 6 landing page" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><p>Lets take a look at the included source code:<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>natas6<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>
<span class="cp">&lt;?</span>
<span class="k">include</span> <span class="s2">"includes/secret.inc"</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$secret</span> <span class="o">==</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s2">"Access granted. The password for natas7 is &lt;censored&gt;"</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s2">"Wrong secret"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">post</span><span class="nt">&gt;</span>
Input secret: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">secret</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">name=</span><span class="s">submit</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"viewsource"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"index-source.html"</span><span class="nt">&gt;</span>View sourcecode<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div><p>Here we get a sample of the actual server side code that is executed on our request. Seems like the language is <a href="http://www.php.net/">php</a>.<ul><li>First a secret.inc file is loaded into the file<li>If browsers <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">request method</a> is POST (and submit exists)<li>And the variable named <code class="highlighter-rouge">$secret</code> is the same as the posted variable secret: we get the password for the next level.</ul><p>The <code class="highlighter-rouge">$secret</code> variable is obviously loaded in the <code class="highlighter-rouge">includes/secret.inc</code>. Perhaps we can look at the file in the browser? A request for <a href="http://natas6.natas.labs.overthewire.org/includes/secret.inc">natas6.natas.labs.overthewire.org/includes/secret.inc</a> actually returns the file, and there the secret is exposed. Now it’s just a matter of writing in the correct secret and submit, then you get the password for the next level.<p><em>Lessons learned: If you have files with sensitive data, don’t leave them in the web-published folder. They will be found.</em><h2 id="level-7">Level 7</h2><p>This level has two links, “Home” and “About”.   <hy-img root-margin="512px"  src="/assets/img/overthewire-natas7-1.png" alt="Natas 7 landing page" >    <noscript><img data-ignore  src="/assets/img/overthewire-natas7-1.png" alt="Natas 7 landing page" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> By clicking the links, we see that there is a variable that changes, that allows us to change the page that is loaded. This is probably done (as in the previous example) with a <a href="http://php.net/manual/en/function.include.php">php include</a>. When using php include, the developer must be sure to sanitize the input to make sure that only legal values are allowed. A quick attempt to see if sanitation is done at all is to change the page variable do something illegal.<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://natas7.natas.labs.overthewire.org/index.php?page=aaa

Warning: include(aaa): failed to open stream: No such file or directory in /var/www/natas/natas7/index.php on line 21
Warning: include(): Failed opening 'aaa' for inclusion (include_path='.:/usr/share/php:/usr/share/pear') in /var/www/natas/natas7/index.php on line 21
</code></pre></div></div><p>Seems like they use include, and that no apparent sanitation is performed. We even get an error message that confirms that include is indeed used. As was stated in the beginning of the challenges, the passwords are stored at <code class="highlighter-rouge">/etc/natas_webpass/natasxx</code>, so we should try to use that as a page <a href="http://natas7.natas.labs.overthewire.org/index.php?page=/etc/natas_webpass/natas8">natas7.natas.labs.overthewire.org/index.php?page=/etc/natas_webpass/natas8</a> That should give us the password for the next level.<p><em>Lessons learned: Don’t trust parameters from the browser. Never put un-sanitized data into an php include. Don’t expose error messages to the browser.</em><h2 id="level-8">Level 8</h2><p>Hm, seems like a repeat of level 6, probably a bit hardened this time. A secret input field, a submit button, and a link to the server-side code.   <hy-img root-margin="512px"  src="/assets/img/overthewire-natas8-1.png" alt="Natas 8 landing page" >    <noscript><img data-ignore  src="/assets/img/overthewire-natas8-1.png" alt="Natas 8 landing page" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img> Lets take a look at the included source code:<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>natas8<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>

<span class="cp">&lt;?</span>

<span class="nv">$encodedSecret</span> <span class="o">=</span> <span class="s2">"3d3d516343746d4d6d6c315669563362"</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">encodeSecret</span><span class="p">(</span><span class="nv">$secret</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nb">strrev</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$secret</span><span class="p">)));</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">encodeSecret</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">])</span> <span class="o">==</span> <span class="nv">$encodedSecret</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">"Access granted. The password for natas9 is &lt;censored&gt;"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">"Wrong secret"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">post</span><span class="nt">&gt;</span>
Input secret: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">secret</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">name=</span><span class="s">submit</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"viewsource"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"index-source.html"</span><span class="nt">&gt;</span>View sourcecode<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div><ul><li>First an encoded secret is defined<li>If browsers request method is POST<li>Then our secret is fed into the <a href="http://php.net/manual/en/functions.user-defined.php">function</a> <code class="highlighter-rouge">encodeSecret</code> and the result is compared to the encoded secret.</ul><p>So, this is encoding/cryptography/algebra basics. Our input <code class="highlighter-rouge">secret</code> is fed into the function <code class="highlighter-rouge">encodeSecret</code> and should result into <code class="highlighter-rouge">encodedSecret</code>. Both the result and the encoding algorithm are known, so the input should also be known. Let’s take a closer look at the <code class="highlighter-rouge">encodeSecret</code> function, and <a href="https://refactoring.com/">refactor</a> it a bit to make it easier to understand.<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nf">encodeSecret</span><span class="p">(</span><span class="nv">$secret</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b64</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$secret</span><span class="p">);</span>
    <span class="nv">$reversed</span> <span class="o">=</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$b64</span><span class="p">);</span>
    <span class="nv">$hexstr</span> <span class="o">=</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$reversed</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$hexstr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Apparently this function does the following transforms on the input (‘a’ used as an example):<ul><li><a href="http://php.net/manual/en/function.base64-encode.php">Base 64 encode</a> the input. (YQ==)<li><a href="http://php.net/manual/en/function.strrev.php">Reverses</a> the base 64 string. (==QY)<li><a href="http://php.net/manual/en/function.bin2hex.php">converts to hexadecimal</a> representation. (3d3d5159)</ul><p>So, by creating our own function that does the reverse, we could easily find the required string to input that makes natas 8 happy. On way is to use the same programming language as the server (php), and use the inverse functions: <a href="http://php.net/manual/en/function.hex2bin.php">hex2bin</a> and <a href="http://php.net/manual/en/function.base64-decode.php">Base 64 decode</a>. Or you could use your favourite programming language, or probably even a standard shell. Quickest way for me was to use <a href="https://www.python.org/">python</a>, which should give you the correct secret to use to get the password for the lext level:<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="n">encodedSecred</span> <span class="o">=</span> <span class="s">'3d3d516343746d4d6d6c315669563362'</span>
<span class="nb">reversed</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">encodedSecret</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ISO-8859-1'</span><span class="p">)</span>
<span class="n">b64</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">secret</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">b64</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ISO-8859-1'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span>
</code></pre></div></div><p><em>Lessons learned: If you want to encrypt something, use a one-way encryption algorithm. Encodings like this are easily broken.</em><h2 id="level-9">Level 9</h2><p>We are on this level met with something that looks like a search. inputting various text into the search gives us a list of the words that contain the input. This time also they have been kind enough to give us the server source code.   <hy-img root-margin="512px"  src="/assets/img/overthewire-natas9-1.png" alt="Natas 9 landing page" >    <noscript><img data-ignore  src="/assets/img/overthewire-natas9-1.png" alt="Natas 9 landing page" /></noscript>    <span class="loading" slot="loading" hidden>      <span class="icon-cog"></span>    </span>  </hy-img><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>natas9<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>
<span class="nt">&lt;form&gt;</span>
Find words containing: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">needle</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">name=</span><span class="s">submit</span> <span class="na">value=</span><span class="s">Search</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="nt">&lt;/form&gt;</span>


Output:
<span class="nt">&lt;pre&gt;</span>
<span class="cp">&lt;?</span>
<span class="nv">$key</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s2">"needle"</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">"needle"</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$key</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">passthru</span><span class="p">(</span><span class="s2">"grep -i </span><span class="nv">$key</span><span class="s2"> dictionary.txt"</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/pre&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"viewsource"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"index-source.html"</span><span class="nt">&gt;</span>View sourcecode<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div><p>So no include this time, but another construct, <a href="http://php.net/manual/en/function.passthru.php">passthru</a> which apparently calls an external program <a href="https://www.gnu.org/savannah-checkouts/gnu/grep/manual/grep.html">grep</a> with some input and our search.<p>One thing that immediately hits me here, is that the request param is sent un-sanitized into the passthru call, leaving the door wide open for <a href="https://www.owasp.org/index.php/Command_Injection">command injection</a>. Let’s see how to prove for ourselves that command injection is possible. I like to use <a href="http://man7.org/linux/man-pages/man1/ls.1.html">ls -al</a> as a proof, so lets try that. We cannot control the beginning <code class="highlighter-rouge">grep -i </code> nor the end <code class="highlighter-rouge">dictionary.txt</code>, but it seems we are free do to what we want in the middle. So we can make the grep return nothing, add a command separator, slap on a comment to ignore the rest of the line. Here it is good to experiment yourself in a shell first, to see what works and what does not. So, by entering <code class="highlighter-rouge">nonono dictionary.txt;ls -al; #</code> as a search term, that should end up as:<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="nt">-i</span> nonono dictionary.txt<span class="p">;</span> <span class="nb">ls</span> <span class="nt">-al</span><span class="p">;</span> <span class="c"># dictionary.txt</span>
<span class="c"># The first command 'grep -i nonono dictionary.txt' will return nothing.</span>
<span class="c"># The second command 'ls -al' should give us the directory listing.</span>
<span class="c"># The final string has now been made to a comment, doing nothing.</span>
</code></pre></div></div><p>Seems we got the directory listing, so command injection was successful. It should now be quite easy to get the password for the next level using <a href="https://ss64.com/bash/cat.html">cat</a>.<p><em>Lessons learned: Avoid user controlled input to include/passtru or similar in other languages. If unavoidable, at least sanitize the input first.</em></div></article><hr class="dingbat related" /><aside class="about related mt4 mb4" role="complementary"><div class="author mt4"><h2 class="page-title hr"> About</h2><p>Mainly a java-developer, but has played with C++, javascript, html, css, php, python and perl. Especially interested in performance and security<div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/fjankk" title="Twitter" class="no-mark-external" rel="me"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/fjank" title="GitHub" class="no-mark-external" rel="me"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a></ul></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr">Related Posts</h2><ul class="related-posts"><li> <a href="/blog/2019-03-14-overthewire-natas-0-4/" class="h4 flip-title"> <span>OverTheWire natas 0-4</span> </a> <time class="heading faded fine" datetime="2019-03-14T00:00:00+01:00">14 Mar 2019</time></ul></aside><aside class="comments related" role="complementary"><h2 class="hr">Comments</h2><div id="disqus_thread"></div><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> <script>!function(w, d) { if (d.getElementById("disqus_thread")) { if (w.DISQUS) { w.DISQUS.reset({ reload: true, config() { this.page.url = w.location.href; this.page.title = d.title; }, }); } else { w.disqus_config = function disqusConfig() { this.page.url = w.location.href; this.page.title = d.title; }; w.loadJSDeferred(d.getElementById("_hrefDisqus").href + '/embed.js'); } } }(window, document);</script></aside><footer role="contentinfo"><hr/><p><small class="copyright">© 2019. All rights reserved. </small><p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">8.4.0</span></small><hr class="sr-only"/></footer></main><hy-drawer class="" align="left" threshold="10" touch-events prevent-default ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"><h2 class="h1"><a href="/">Fjanks security pages</a></h2><p class="fine"> A blog about security, CTF, vulnerabilities, pen-testing and other interesting things that are related to security.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_navigation" href="/about/" class="sidebar-nav-item" > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/fjankk" title="Twitter" class="no-mark-external" rel="me"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/fjank" title="GitHub" class="no-mark-external" rel="me"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if !IE]><!----> <script>loadJSDeferred(document.getElementById('_hrefJS').href);</script> <!--<![endif]--> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'UA-136398928-1', 'auto'); /**/ var pushStateEl = d.getElementsByTagName('hy-push-state')[0]; var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <script> if ('serviceWorker' in navigator) { navigator.serviceWorker.getRegistration() .then(r => r.unregister()) .catch(() => {}); } </script><h2 class="sr-only" hidden>Templates (for web app):</h2><template id="_animation-template" hidden><div class="animation-main fixed-top"><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template" hidden><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template" hidden><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_back-template" hidden> <a id="_back" class="back nav-btn fl no-hover"> <span class="sr-only">Back</span> <span class="icon-arrow-left2"></span> </a> </template> <template id="_permalink-template" hidden> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="icon-link"></span> </a> </template></html>
